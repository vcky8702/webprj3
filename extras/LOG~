# This is a FAKE log, produced using the command:
#
#   ~/44/bin/do-cmd-log.mjs log-cmds.mjs 

# Assume server started earlier with many books preloaded using command:
# ./dist/index.js config.mjs ~/cs544/data/books.json

# search for books on JavaScript
#
# curl options:
#  -s:  silent, avoids progress indicators
#  -k:  accept self-signed certificates
#  -D /dev/stderr: print response headers on stderr
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 1632
ETag: W/"660-rp9Dm3GZ3e4SjQsyh7Ihc5ayctw"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript",
      "method": "GET"
    },
    "next": {
      "rel": "next",
      "href": "/api/books?search=JavaScript&index=5&count=5",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 3,
        "isbn": "791-015-850-1",
        "title": "Advanced JavaScript Programming",
        "authors": [
          "Windsheimer, Chasity",
          "Weinberg, Johnathen"
        ],
        "pages": 534,
        "year": 2017,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/791-015-850-1",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "732-641-074-7",
        "title": "Basics of JavaScript Programming",
        "authors": [
          "Clemens, Danae",
          "Craig, Hannah",
          "Wunder, Derek"
        ],
        "pages": 417,
        "year": 2014,
        "publisher": "Addison-Wesley"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/732-641-074-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "910-233-805-6",
        "title": "Fundamentals of JavaScript Programming",
        "authors": [
          "Aguirre, Tia",
          "Weitz, Anna",
          "Sarabia, Sandra"
        ],
        "pages": 397,
        "year": 2000,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/910-233-805-6",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "070-094-483-4",
        "title": "Intermediate JavaScript Programming",
        "authors": [
          "Sarabia, Sandra",
          "Cockfield, Kyla"
        ],
        "pages": 455,
        "year": 2017,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/070-094-483-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "823-126-010-2",
        "title": "JavaScript Prats and Pitfalls",
        "authors": [
          "Wedlow, Gary",
          "Riffe, Gabriele",
          "Clemens, Danae",
          "Anguiano, Tynia"
        ],
        "pages": 222,
        "year": 2018,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/823-126-010-2",
          "method": "GET"
        }
      }
    }
  ]
}

# Use isbn '791-015-850-1' from first of previous results to directly
# access same book without doing a search.
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books/791-015-850-1' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 298
ETag: W/"12a-W6XGXHql6xfLSSSKW3QheVfs2Yo"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books/791-015-850-1",
      "method": "GET"
    }
  },
  "result": {
    "nCopies": 3,
    "isbn": "791-015-850-1",
    "title": "Advanced JavaScript Programming",
    "authors": [
      "Windsheimer, Chasity",
      "Weinberg, Johnathen"
    ],
    "pages": 534,
    "year": 2017,
    "publisher": "Pearson"
  }
}

# Use invalid isbn '791-015-850-1x' from to show result when accessing
# a non-existent book.
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books/791-015-850-1x' \
    | jq .
HTTP/1.1 404 Not Found
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 117
ETag: W/"75-8BhzIRY0UfMGA6NNFiE5kho7nCY"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 404,
  "errors": [
    {
      "message": "no book for isbn '791-015-850-1x'",
      "options": {
        "code": "NOT_FOUND"
      }
    }
  ]
}

# search for books on JavaScript by Flanagan
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript+Flanagan' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 392
ETag: W/"188-0zw3l7WLpfEdVqNHWQedHpj2PFA"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript+Flanagan",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 2,
        "isbn": "149-195-202-4",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David Flanagan"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-4",
          "method": "GET"
        }
      }
    }
  ]
}

# search for books by 'SomeAuthor' (should return no books)
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=SomeAuthor' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 123
ETag: W/"7b-CJHmvwA2paE1mu9Fw5ygfuj10EU"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=SomeAuthor",
      "method": "GET"
    }
  },
  "result": []
}

# show contents of books/book1.json file.
$ cat 'books/book1.json'
{
  "title": "JavaScript: The Definitive Guide, 7th Edition",
  "authors": [
    "David SomeAuthor"
  ],
  "isbn": "149-195-202-5",
  "pages": 704,
  "year": 2020,
  "publisher": "O'Reilly",
  "nCopies": 2
}



# add book using data from books/book1.json
#
# curl options:
#  -H HEADER: send HTTP request header HEADER
#  -d @FILE: send HTTP request body from FILE (induces POST method)
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/book1.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 201 Created
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Location: /api/books/149-195-202-5
Content-Type: application/json; charset=utf-8
Content-Length: 273
ETag: W/"111-WdAln7kwMBlVbRPA14teMDvGt7Q"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 201,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books",
      "method": "PUT"
    }
  },
  "result": {
    "nCopies": 2,
    "isbn": "149-195-202-5",
    "title": "JavaScript: The Definitive Guide, 7th Edition",
    "authors": [
      "David SomeAuthor"
    ],
    "pages": 704,
    "year": 2020,
    "publisher": "O'Reilly"
  }
}

# search again for books by 'SomeAuthor' 
# (should return newly added book)
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=SomeAuthor' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 385
ETag: W/"181-y9BnYYqoMDoku7kXSQRCmg9Xyb8"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=SomeAuthor",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 2,
        "isbn": "149-195-202-5",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David SomeAuthor"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-5",
          "method": "GET"
        }
      }
    }
  ]
}

# Use isbn '149-195-202-5' from previous result to directly access
# same book without doing a search.
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books/149-195-202-5' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 287
ETag: W/"11f-nDmQ7eYyE+QOepybt2sCjlPMvd4"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books/149-195-202-5",
      "method": "GET"
    }
  },
  "result": {
    "nCopies": 2,
    "isbn": "149-195-202-5",
    "title": "JavaScript: The Definitive Guide, 7th Edition",
    "authors": [
      "David SomeAuthor"
    ],
    "pages": 704,
    "year": 2020,
    "publisher": "O'Reilly"
  }
}

# attempt to add book using data from books/book1.json once again
# (additional copies added)
#
# curl options:
#  -H HEADER: send HTTP request header HEADER
#  -d @FILE: send HTTP request body from FILE (induces POST method)
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/book1.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 201 Created
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Location: /api/books/149-195-202-5
Content-Type: application/json; charset=utf-8
Content-Length: 273
ETag: W/"111-yFg/MtaApSTUm8Feipz3qwS2SNw"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 201,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books",
      "method": "PUT"
    }
  },
  "result": {
    "nCopies": 4,
    "isbn": "149-195-202-5",
    "title": "JavaScript: The Definitive Guide, 7th Edition",
    "authors": [
      "David SomeAuthor"
    ],
    "pages": 704,
    "year": 2020,
    "publisher": "O'Reilly"
  }
}

# show contents of books/book2.json file (identical to book1.json,
        but a different edition)
$ cat 'books/book2.json'
{
  "title": "JavaScript: The Definitive Guide, 8th Edition",
  "authors": [
    "David SomeAuthor"
  ],
  "isbn": "149-195-202-5",
  "pages": 704,
  "year": 2020,
  "publisher": "O'Reilly",
  "nCopies": 2
}



# attempt to add book using data from books/book2.json once again;
# expect BAD_REQUEST since the ISBN is the same as book1 but the
# title is different.
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/book2.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 145
ETag: W/"91-22IPBJuHU5Q6c/HWo2m7r63aK2M"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "inconsistent title data for book 149-195-202-5",
      "options": {
        "code": "BAD_REQ",
        "widget": "title"
      }
    }
  ]
}

# Retrieve all books on 'JavaScript'
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript&count=999999' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 3758
ETag: W/"eae-vHSCV1m4aFsdtLD6mDwqoOTTQFk"
Date: Tue, 19 Mar 2024 14:36:21 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript&count=999999",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 3,
        "isbn": "791-015-850-1",
        "title": "Advanced JavaScript Programming",
        "authors": [
          "Windsheimer, Chasity",
          "Weinberg, Johnathen"
        ],
        "pages": 534,
        "year": 2017,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/791-015-850-1",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "732-641-074-7",
        "title": "Basics of JavaScript Programming",
        "authors": [
          "Clemens, Danae",
          "Craig, Hannah",
          "Wunder, Derek"
        ],
        "pages": 417,
        "year": 2014,
        "publisher": "Addison-Wesley"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/732-641-074-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "910-233-805-6",
        "title": "Fundamentals of JavaScript Programming",
        "authors": [
          "Aguirre, Tia",
          "Weitz, Anna",
          "Sarabia, Sandra"
        ],
        "pages": 397,
        "year": 2000,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/910-233-805-6",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "070-094-483-4",
        "title": "Intermediate JavaScript Programming",
        "authors": [
          "Sarabia, Sandra",
          "Cockfield, Kyla"
        ],
        "pages": 455,
        "year": 2017,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/070-094-483-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "823-126-010-2",
        "title": "JavaScript Prats and Pitfalls",
        "authors": [
          "Wedlow, Gary",
          "Riffe, Gabriele",
          "Clemens, Danae",
          "Anguiano, Tynia"
        ],
        "pages": 222,
        "year": 2018,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/823-126-010-2",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 4,
        "isbn": "387-267-458-7",
        "title": "JavaScript Programmers Reference",
        "authors": [
          "Dangers, Jaylen",
          "Tannehill, Everett"
        ],
        "pages": 362,
        "year": 2011,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/387-267-458-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 4,
        "isbn": "215-346-226-5",
        "title": "JavaScript Programming Made Easy",
        "authors": [
          "Gandaria, Deric",
          "Aguirre, Tia",
          "Wigfield, Saul"
        ],
        "pages": 133,
        "year": 2013,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/215-346-226-5",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "021-578-548-4",
        "title": "JavaScript: The Definitive Guide",
        "authors": [
          "Uecker, Koby",
          "Chamlee, Lorena"
        ],
        "pages": 421,
        "year": 2011,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/021-578-548-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 4,
        "isbn": "149-195-202-5",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David SomeAuthor"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-5",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "149-195-202-4",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David Flanagan"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "535-020-763-2",
        "title": "Programming in JavaScript",
        "authors": [
          "Weitz, Anna",
          "Gandaria, Alani",
          "Alanis, Jaida"
        ],
        "pages": 121,
        "year": 2005,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/535-020-763-2",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "555-992-091-2",
        "title": "The ABC's of JavaScript Programming",
        "authors": [
          "Atkins, Elida",
          "Wire, Brody",
          "Norman, Carter",
          "Velasco, Jameson"
        ],
        "pages": 565,
        "year": 2009,
        "publisher": "Manning"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/555-992-091-2",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "403-747-725-3",
        "title": "The Idiot's Guide to JavaScript",
        "authors": [
          "Wojahn, Anamarie",
          "Alanis, Jaida",
          "Weigt, Aileen"
        ],
        "pages": 314,
        "year": 2003,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/403-747-725-3",
          "method": "GET"
        }
      }
    }
  ]
}

# Retrieve first page of results for  books on 'JavaScript'
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 1632
ETag: W/"660-rp9Dm3GZ3e4SjQsyh7Ihc5ayctw"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript",
      "method": "GET"
    },
    "next": {
      "rel": "next",
      "href": "/api/books?search=JavaScript&index=5&count=5",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 3,
        "isbn": "791-015-850-1",
        "title": "Advanced JavaScript Programming",
        "authors": [
          "Windsheimer, Chasity",
          "Weinberg, Johnathen"
        ],
        "pages": 534,
        "year": 2017,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/791-015-850-1",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "732-641-074-7",
        "title": "Basics of JavaScript Programming",
        "authors": [
          "Clemens, Danae",
          "Craig, Hannah",
          "Wunder, Derek"
        ],
        "pages": 417,
        "year": 2014,
        "publisher": "Addison-Wesley"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/732-641-074-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "910-233-805-6",
        "title": "Fundamentals of JavaScript Programming",
        "authors": [
          "Aguirre, Tia",
          "Weitz, Anna",
          "Sarabia, Sandra"
        ],
        "pages": 397,
        "year": 2000,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/910-233-805-6",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "070-094-483-4",
        "title": "Intermediate JavaScript Programming",
        "authors": [
          "Sarabia, Sandra",
          "Cockfield, Kyla"
        ],
        "pages": 455,
        "year": 2017,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/070-094-483-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "823-126-010-2",
        "title": "JavaScript Prats and Pitfalls",
        "authors": [
          "Wedlow, Gary",
          "Riffe, Gabriele",
          "Clemens, Danae",
          "Anguiano, Tynia"
        ],
        "pages": 222,
        "year": 2018,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/823-126-010-2",
          "method": "GET"
        }
      }
    }
  ]
}

# use next link '/api/books?search=JavaScript&index=5&count=5'
# from previous command to retrieve next page of results
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript&index=5&count=5' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 1669
ETag: W/"685-uw9/4GwAedHbI6ifnFb6x3kbsSM"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript&index=5&count=5",
      "method": "GET"
    },
    "next": {
      "rel": "next",
      "href": "/api/books?search=JavaScript&index=10&count=5",
      "method": "GET"
    },
    "prev": {
      "rel": "prev",
      "href": "/api/books?search=JavaScript&index=0&count=5",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 4,
        "isbn": "387-267-458-7",
        "title": "JavaScript Programmers Reference",
        "authors": [
          "Dangers, Jaylen",
          "Tannehill, Everett"
        ],
        "pages": 362,
        "year": 2011,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/387-267-458-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 4,
        "isbn": "215-346-226-5",
        "title": "JavaScript Programming Made Easy",
        "authors": [
          "Gandaria, Deric",
          "Aguirre, Tia",
          "Wigfield, Saul"
        ],
        "pages": 133,
        "year": 2013,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/215-346-226-5",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "021-578-548-4",
        "title": "JavaScript: The Definitive Guide",
        "authors": [
          "Uecker, Koby",
          "Chamlee, Lorena"
        ],
        "pages": 421,
        "year": 2011,
        "publisher": "New Starch"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/021-578-548-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "149-195-202-4",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David Flanagan"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 4,
        "isbn": "149-195-202-5",
        "title": "JavaScript: The Definitive Guide, 7th Edition",
        "authors": [
          "David SomeAuthor"
        ],
        "pages": 704,
        "year": 2020,
        "publisher": "O'Reilly"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/149-195-202-5",
          "method": "GET"
        }
      }
    }
  ]
}

# use prev link '/api/books?search=JavaScript&index=0&count=5'
# from previous command to retrieve previous page of results
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript&index=0&count=5' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 1648
ETag: W/"670-yJiPNnnBtz9oU5flX9Rs4fZHvzU"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript&index=0&count=5",
      "method": "GET"
    },
    "next": {
      "rel": "next",
      "href": "/api/books?search=JavaScript&index=5&count=5",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 3,
        "isbn": "791-015-850-1",
        "title": "Advanced JavaScript Programming",
        "authors": [
          "Windsheimer, Chasity",
          "Weinberg, Johnathen"
        ],
        "pages": 534,
        "year": 2017,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/791-015-850-1",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "732-641-074-7",
        "title": "Basics of JavaScript Programming",
        "authors": [
          "Clemens, Danae",
          "Craig, Hannah",
          "Wunder, Derek"
        ],
        "pages": 417,
        "year": 2014,
        "publisher": "Addison-Wesley"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/732-641-074-7",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "910-233-805-6",
        "title": "Fundamentals of JavaScript Programming",
        "authors": [
          "Aguirre, Tia",
          "Weitz, Anna",
          "Sarabia, Sandra"
        ],
        "pages": 397,
        "year": 2000,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/910-233-805-6",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "070-094-483-4",
        "title": "Intermediate JavaScript Programming",
        "authors": [
          "Sarabia, Sandra",
          "Cockfield, Kyla"
        ],
        "pages": 455,
        "year": 2017,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/070-094-483-4",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 3,
        "isbn": "823-126-010-2",
        "title": "JavaScript Prats and Pitfalls",
        "authors": [
          "Wedlow, Gary",
          "Riffe, Gabriele",
          "Clemens, Danae",
          "Anguiano, Tynia"
        ],
        "pages": 222,
        "year": 2018,
        "publisher": "Pearson"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/823-126-010-2",
          "method": "GET"
        }
      }
    }
  ]
}

# Retrieve intermediate page of books of results for
# 'JavaScript' books
$ curl -s -k -D /dev/stderr \
       'https://localhost:2345/api/books?search=JavaScript&index=2&count=2' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 884
ETag: W/"374-JuOrh5h1MTOlpIX/6Kg+h1/cnaU"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/books?search=JavaScript&index=2&count=2",
      "method": "GET"
    },
    "next": {
      "rel": "next",
      "href": "/api/books?search=JavaScript&index=4&count=2",
      "method": "GET"
    },
    "prev": {
      "rel": "prev",
      "href": "/api/books?search=JavaScript&index=0&count=2",
      "method": "GET"
    }
  },
  "result": [
    {
      "result": {
        "nCopies": 3,
        "isbn": "910-233-805-6",
        "title": "Fundamentals of JavaScript Programming",
        "authors": [
          "Aguirre, Tia",
          "Weitz, Anna",
          "Sarabia, Sandra"
        ],
        "pages": 397,
        "year": 2000,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/910-233-805-6",
          "method": "GET"
        }
      }
    },
    {
      "result": {
        "nCopies": 2,
        "isbn": "070-094-483-4",
        "title": "Intermediate JavaScript Programming",
        "authors": [
          "Sarabia, Sandra",
          "Cockfield, Kyla"
        ],
        "pages": 455,
        "year": 2017,
        "publisher": "Prentice-Hall"
      },
      "links": {
        "self": {
          "rel": "self",
          "href": "/api/books/070-094-483-4",
          "method": "GET"
        }
      }
    }
  ]
}

Patron john checks out book 070-094-483-4
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "john", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 96
ETag: W/"60-Ph0995RY2baGUQjuwc+P5Yk3m9k"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/lendings",
      "method": "PUT"
    }
  }
}

Patron john attempts to check out book 070-094-483-4 again
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "john", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 152
ETag: W/"98-2EbJMEdCQQucqCf6D+7BIaU8r48"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "patron john already has book 070-094-483-4 checked out",
      "options": {
        "code": "BAD_REQ",
        "widget": "isbn"
      }
    }
  ]
}

Patron john returns book 910-233-805-6 which he does not have checked out
$ curl -s -k -X DELETE -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "john", "isbn": "910-233-805-6"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 146
ETag: W/"92-Han6IS0FXN8RiFM+zkVLZlEM110"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "no checkout of book 910-233-805-6 by patron john",
      "options": {
        "code": "BAD_REQ",
        "widget": "isbn"
      }
    }
  ]
}

Patron sue checks out second copy of book 070-094-483-4
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "sue", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 96
ETag: W/"60-Ph0995RY2baGUQjuwc+P5Yk3m9k"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/lendings",
      "method": "PUT"
    }
  }
}

Patron jane checks out book 070-094-483-4, but there are no copies left
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "jane", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 156
ETag: W/"9c-YgHVdB8U8EyvCa2gkniGh7ely5c"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "no copies of book 070-094-483-4 are available for checkout",
      "options": {
        "code": "BAD_REQ",
        "widget": "isbn"
      }
    }
  ]
}

Patron john returns book 070-094-483-4 which he does have checked out
$ curl -s -k -X DELETE -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "john", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 113
ETag: W/"71-aEQdNumTBrwJbzBHyob48xwI8mY"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/lendings",
      "method": "DELETE"
    }
  },
  "result": true
}

Patron jane checks out book 070-094-483-4, which is successful after
      the return by john
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' \
       -d '{"patronId": "jane", "isbn": "070-094-483-4"}' \
       'https://localhost:2345/api/lendings' \
    | jq .
HTTP/1.1 200 OK
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 96
ETag: W/"60-Ph0995RY2baGUQjuwc+P5Yk3m9k"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": true,
  "status": 200,
  "links": {
    "self": {
      "rel": "self",
      "href": "/api/lendings",
      "method": "PUT"
    }
  }
}

#### Various errors ####

# show contents of books/missing-required.json file.
$ cat 'books/missing-required.json'
{

}



# attempt to add book from books/missing-required.json
# (expect BAD_REQUEST)
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/missing-required.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 502
ETag: W/"1f6-dLG9i/XINK2I9fHr2XQgiaFWRtE"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "isbn is required",
      "options": {
        "code": "MISSING",
        "path": "isbn"
      }
    },
    {
      "message": "title is required",
      "options": {
        "code": "MISSING",
        "path": "title"
      }
    },
    {
      "message": "authors is required",
      "options": {
        "code": "MISSING",
        "path": "authors"
      }
    },
    {
      "message": "pages is required",
      "options": {
        "code": "MISSING",
        "path": "pages"
      }
    },
    {
      "message": "year is required",
      "options": {
        "code": "MISSING",
        "path": "year"
      }
    },
    {
      "message": "publisher is required",
      "options": {
        "code": "MISSING",
        "path": "publisher"
      }
    }
  ]
}

# show contents of books/bad-types.json file.
$ cat 'books/bad-types.json'
{
  "title": 1995,
  "authors": "David Flanagan",
  "isbn": 44,
  "pages": "704",
  "year": "2020",
  "publisher": 99,
  "nCopies": "2"
}



# attempt to create user using data from books/bad-types.json
# (expect BAD_REQUEST)
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/bad-types.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 658
ETag: W/"292-Mp/2QNb3jCP2ANbfnTnx232xqZA"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "isOk": false,
  "status": 400,
  "errors": [
    {
      "message": "isbn must have type string",
      "options": {
        "code": "BAD_TYPE",
        "path": "isbn"
      }
    },
    {
      "message": "title must have type string",
      "options": {
        "code": "BAD_TYPE",
        "path": "title"
      }
    },
    {
      "message": "authors must have type array",
      "options": {
        "code": "BAD_TYPE",
        "path": "authors"
      }
    },
    {
      "message": "pages must have type number",
      "options": {
        "code": "BAD_TYPE",
        "path": "pages"
      }
    },
    {
      "message": "year must have type number",
      "options": {
        "code": "BAD_TYPE",
        "path": "year"
      }
    },
    {
      "message": "publisher must have type string",
      "options": {
        "code": "BAD_TYPE",
        "path": "publisher"
      }
    },
    {
      "message": "nCopies must have type number",
      "options": {
        "code": "BAD_TYPE",
        "path": "nCopies"
      }
    }
  ]
}

# attempt to create book using json with syntax error
# (expect BAD_REQUEST)
$ curl -s -k -X PUT -D /dev/stderr \
       -H 'Content-Type: application/json' -d '{"isbn":}' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 400 Bad Request
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 133
ETag: W/"85-o29AywT4oo2WJCMDjcGwNObhBg8"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "status": "Bad Request",
  "errors": [
    {
      "options": {
        "code": "SYNTAX"
      },
      "message": "Unexpected token '}', \"{\"isbn\":}\" is not valid JSON"
    }
  ]
}

# add book using data from books/book1.json, but use wrong
# POST method; expect a 404
#
# curl options:
#  -H HEADER: send HTTP request header HEADER
#  -d @FILE: send HTTP request body from FILE (induces POST method)
$ curl -s -k -X POST -D /dev/stderr \
       -H 'Content-Type: application/json' -d '@books/book1.json' \
       'https://localhost:2345/api/books' \
    | jq .
HTTP/1.1 404 Not Found
X-Powered-By: Express
Vary: Origin
Access-Control-Expose-Headers: Location,Content-Type
Content-Type: application/json; charset=utf-8
Content-Length: 104
ETag: W/"68-/mW10jbzHHvweOSRH9j5voGjO+E"
Date: Tue, 19 Mar 2024 14:36:22 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{
  "status": 404,
  "errors": [
    {
      "options": {
        "code": "NOT_FOUND"
      },
      "message": "POST not supported for /api/books"
    }
  ]
}

